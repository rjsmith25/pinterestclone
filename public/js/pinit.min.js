(function(){"use strict";angular.module("app",["ngRoute","auth0","angular-storage","angular-jwt","app.common","app.home","app.pinboard"]).config(e).run(t);e.$inject=["authProvider","$routeProvider","$locationProvider","$httpProvider","jwtInterceptorProvider"];function e(e,t,n,r,o){e.init({domain:"mywebapp.auth0.com",clientID:"gkpoo1A5WB4XwiUT2e4bdJRFI0QXqUEA",loginUrl:"/"});n.html5Mode(true);t.otherwise({redirectTo:"/"});o.tokenGetter=function(e){return e.get("token")};r.interceptors.push("jwtInterceptor")}t.$inject=["$rootScope","auth","store","jwtHelper","$location"];function t(e,t,n,r,o){t.hookEvents();e.$on("$locationChangeStart",function(){var e=n.get("token");if(e){if(!r.isTokenExpired(e)){if(!t.isAuthenticated){t.authenticate(n.get("profile"),e)}}}})}})();(function(e,t,n){"use strict";function r(e,n,r){return{restrict:"ECA",terminal:!0,priority:400,transclude:"element",link:function(o,i,a,u,s){function l(){p&&(r.cancel(p),p=null);h&&(h.$destroy(),h=null);f&&(p=r.leave(f),p.then(function(){p=null}),f=null)}function c(){var a=e.current&&e.current.locals;if(t.isDefined(a&&a.$template)){var a=o.$new(),u=e.current;f=s(a,function(e){r.enter(e,null,f||i).then(function(){!t.isDefined(g)||g&&!o.$eval(g)||n()});l()});h=u.scope=a;h.$emit("$viewContentLoaded");h.$eval(d)}else l()}var h,f,p,g=a.autoscroll,d=a.onload||"";o.$on("$routeChangeSuccess",c);c()}}}function o(e,t,n){return{restrict:"ECA",priority:-400,link:function(r,o){var i=n.current,a=i.locals;o.html(a.$template);var u=e(o.contents());if(i.controller){a.$scope=r;var s=t(i.controller,a);i.controllerAs&&(r[i.controllerAs]=s);o.data("$ngControllerController",s);o.children().data("$ngControllerController",s)}r[i.resolveAs||"$resolve"]=a;u(r)}}}e=t.module("ngRoute",["ng"]).provider("$route",function(){function e(e,n){return t.extend(Object.create(e),n)}function n(e,t){var n=t.caseInsensitiveMatch,r={originalPath:e,regexp:e},o=r.keys=[];e=e.replace(/([().])/g,"\\$1").replace(/(\/)?:(\w+)([\?\*])?/g,function(e,t,n,r){e="?"===r?r:null;r="*"===r?r:null;o.push({name:n,optional:!!e});t=t||"";return""+(e?"":t)+"(?:"+(e?t:"")+(r&&"(.+?)"||"([^/]+)")+(e||"")+")"+(e||"")}).replace(/([\/$\*])/g,"\\$1");r.regexp=new RegExp("^"+e+"$",n?"i":"");return r}var r={};this.when=function(e,o){var i=t.copy(o);t.isUndefined(i.reloadOnSearch)&&(i.reloadOnSearch=!0);t.isUndefined(i.caseInsensitiveMatch)&&(i.caseInsensitiveMatch=this.caseInsensitiveMatch);r[e]=t.extend(i,e&&n(e,i));if(e){var a="/"==e[e.length-1]?e.substr(0,e.length-1):e+"/";r[a]=t.extend({redirectTo:e},n(a,i))}return this};this.caseInsensitiveMatch=!1;this.otherwise=function(e){"string"===typeof e&&(e={redirectTo:e});this.when(null,e);return this};this.$get=["$rootScope","$location","$routeParams","$q","$injector","$templateRequest","$sce",function(n,o,a,u,s,l,c){function h(e){var r=$.current;(v=(m=p())&&r&&m.$$route===r.$$route&&t.equals(m.pathParams,r.pathParams)&&!m.reloadOnSearch&&!d)||!r&&!m||n.$broadcast("$routeChangeStart",m,r).defaultPrevented&&e&&e.preventDefault()}function f(){var e=$.current,r=m;if(v)e.params=r.params,t.copy(e.params,a),n.$broadcast("$routeUpdate",e);else if(r||e)d=!1,($.current=r)&&r.redirectTo&&(t.isString(r.redirectTo)?o.path(g(r.redirectTo,r.params)).search(r.params).replace():o.url(r.redirectTo(r.pathParams,o.path(),o.search())).replace()),u.when(r).then(function(){if(r){var e=t.extend({},r.resolve),n,o;t.forEach(e,function(n,r){e[r]=t.isString(n)?s.get(n):s.invoke(n,null,null,r)});t.isDefined(n=r.template)?t.isFunction(n)&&(n=n(r.params)):t.isDefined(o=r.templateUrl)&&(t.isFunction(o)&&(o=o(r.params)),t.isDefined(o)&&(r.loadedTemplateUrl=c.valueOf(o),n=l(o)));t.isDefined(n)&&(e.$template=n);return u.all(e)}}).then(function(o){r==$.current&&(r&&(r.locals=o,t.copy(r.params,a)),n.$broadcast("$routeChangeSuccess",r,e))},function(t){r==$.current&&n.$broadcast("$routeChangeError",r,e,t)})}function p(){var n,i;t.forEach(r,function(r,a){var u;if(u=!i){var s=o.path();u=r.keys;var l={};if(r.regexp)if(s=r.regexp.exec(s)){for(var c=1,h=s.length;c<h;++c){var f=u[c-1],p=s[c];f&&p&&(l[f.name]=p)}u=l}else u=null;else u=null;u=n=u}u&&(i=e(r,{params:t.extend({},o.search(),n),pathParams:n}),i.$$route=r)});return i||r[null]&&e(r[null],{params:{},pathParams:{}})}function g(e,n){var r=[];t.forEach((e||"").split(":"),function(e,t){if(0===t)r.push(e);else{var o=e.match(/(\w+)(?:[?*])?(.*)/),i=o[1];r.push(n[i]);r.push(o[2]||"");delete n[i]}});return r.join("")}var d=!1,m,v,$={routes:r,reload:function(){d=!0;var e={defaultPrevented:!1,preventDefault:function(){this.defaultPrevented=!0;d=!1}};n.$evalAsync(function(){h(e);e.defaultPrevented||f()})},updateParams:function(e){if(this.current&&this.current.$$route)e=t.extend({},this.current.params,e),o.path(g(this.current.$$route.originalPath,e)),o.search(e);else throw i("norout")}};n.$on("$locationChangeStart",h);n.$on("$locationChangeSuccess",f);return $}]});var i=t.$$minErr("ngRoute");e.provider("$routeParams",function(){this.$get=function(){return{}}});e.directive("ngView",r);e.directive("ngView",o);r.$inject=["$route","$anchorScroll","$animate"];o.$inject=["$compile","$controller","$route"]})(window,window.angular);!function(){angular.module("angular-storage",["angular-storage.store"]),angular.module("angular-storage.cookieStorage",[]).service("cookieStorage",["$injector",function(e){var t=e.get("$cookieStore");this.set=function(e,n){return t.put(e,n)},this.get=function(e){return t.get(e)},this.remove=function(e){return t.remove(e)}}]),angular.module("angular-storage.internalStore",["angular-storage.localStorage","angular-storage.sessionStorage"]).factory("InternalStore",["$log","$injector",function(e,t){function n(e,n,r){this.namespace=e||null,this.delimiter=r||".",this.inMemoryCache={},this.storage=t.get(n||"localStorage")}return n.prototype.getNamespacedKey=function(e){return this.namespace?[this.namespace,e].join(this.delimiter):e},n.prototype.set=function(e,t){this.inMemoryCache[e]=t,this.storage.set(this.getNamespacedKey(e),JSON.stringify(t))},n.prototype.get=function(t){var n=null;if(t in this.inMemoryCache)return this.inMemoryCache[t];var r=this.storage.get(this.getNamespacedKey(t));try{n="undefined"==typeof r||"undefined"===r?void 0:JSON.parse(r),this.inMemoryCache[t]=n}catch(o){e.error("Error parsing saved value",o),this.remove(t)}return n},n.prototype.remove=function(e){this.inMemoryCache[e]=null,this.storage.remove(this.getNamespacedKey(e))},n}]),angular.module("angular-storage.localStorage",["angular-storage.cookieStorage"]).service("localStorage",["$window","$injector",function(e,t){var n;try{e.localStorage.setItem("testKey","test"),e.localStorage.removeItem("testKey"),n=!0}catch(r){n=!1}if(n)this.set=function(t,n){return e.localStorage.setItem(t,n)},this.get=function(t){return e.localStorage.getItem(t)},this.remove=function(t){return e.localStorage.removeItem(t)};else{var o=t.get("cookieStorage");this.set=o.set,this.get=o.get,this.remove=o.remove}}]),angular.module("angular-storage.sessionStorage",["angular-storage.cookieStorage"]).service("sessionStorage",["$window","$injector",function(e,t){var n;try{e.sessionStorage.setItem("testKey","test"),e.sessionStorage.removeItem("testKey"),n=!0}catch(r){n=!1}if(n)this.set=function(t,n){return e.sessionStorage.setItem(t,n)},this.get=function(t){return e.sessionStorage.getItem(t)},this.remove=function(t){return e.sessionStorage.removeItem(t)};else{var o=t.get("cookieStorage");this.set=o.set,this.get=o.get,this.remove=o.remove}}]),angular.module("angular-storage.store",["angular-storage.internalStore"]).provider("store",function(){var e="localStorage";this.setStore=function(t){t&&angular.isString(t)&&(e=t)},this.$get=["InternalStore",function(t){var n=new t(null,e);return n.getNamespacedStore=function(e,n,r){return new t(e,n,r)},n}]})}();!function(){angular.module("angular-jwt",["angular-jwt.interceptor","angular-jwt.jwt"]),angular.module("angular-jwt.interceptor",[]).provider("jwtInterceptor",function(){this.urlParam=null,this.authHeader="Authorization",this.authPrefix="Bearer ",this.tokenGetter=function(){return null};var e=this;this.$get=["$q","$injector","$rootScope",function(t,n,r){return{request:function(r){if(r.skipAuthorization)return r;if(e.urlParam){if(r.params=r.params||{},r.params[e.urlParam])return r}else if(r.headers=r.headers||{},r.headers[e.authHeader])return r;var o=t.when(n.invoke(e.tokenGetter,this,{config:r}));return o.then(function(t){return t&&(e.urlParam?r.params[e.urlParam]=t:r.headers[e.authHeader]=e.authPrefix+t),r})},responseError:function(e){return 401===e.status&&r.$broadcast("unauthenticated",e),t.reject(e)}}}]}),angular.module("angular-jwt.jwt",[]).service("jwtHelper",function(){this.urlBase64Decode=function(e){var t=e.replace(/-/g,"+").replace(/_/g,"/");switch(t.length%4){case 0:break;case 2:t+="==";break;case 3:t+="=";break;default:throw"Illegal base64url string!"}return decodeURIComponent(escape(window.atob(t)))},this.decodeToken=function(e){var t=e.split(".");if(3!==t.length)throw new Error("JWT must have 3 parts");var n=this.urlBase64Decode(t[1]);if(!n)throw new Error("Cannot decode the token");return JSON.parse(n)},this.getTokenExpirationDate=function(e){var t;if(t=this.decodeToken(e),"undefined"==typeof t.exp)return null;var n=new Date(0);return n.setUTCSeconds(t.exp),n},this.isTokenExpired=function(e,t){var n=this.getTokenExpirationDate(e);return t=t||0,null===n?!1:!(n.valueOf()>(new Date).valueOf()+1e3*t)}})}();!function(){angular.module("auth0",["auth0.service","auth0.utils"]).run(["auth",function(e){e.hookEvents()}]),angular.module("auth0.utils",[]).provider("authUtils",function(){var e={capitalize:function(e){return e?e.charAt(0).toUpperCase()+e.substring(1).toLowerCase():null},fnName:function(e){var t=e.toString();return t=t.substr("function ".length),t=t.substr(0,t.indexOf("(")),t?t.trim():t}};angular.extend(this,e),this.$get=["$rootScope","$q",function(t,n){var r={};return angular.extend(r,e),r.safeApply=function(e){var n=t.$root.$$phase;"$apply"===n||"$digest"===n?e&&"function"==typeof e&&e():t.$apply(e)},r.callbackify=function(e,t,n,o){return angular.isFunction(e)?function(i){i=Array.prototype.slice.call(arguments);var a=function(e,r,o){return e?void(n&&n(e)):(o=Array.prototype.slice.call(arguments,1),void(t&&t.apply(null,o)))};(t||n)&&i.push(r.applied(a)),e.apply(o,i)}:void 0},r.promisify=function(e,t){return angular.isFunction(e)?function(o){o=Array.prototype.slice.call(arguments);var i=n.defer(),a=function(e,t,n){return e?void i.reject(e):(n=Array.prototype.slice.call(arguments,1),void i.resolve(n.length>1?n:t))};return o.push(r.applied(a)),e.apply(t,o),i.promise.spread=i.promise.spread||function(e,t){return i.promise.then(function(t){return Array.isArray(t)?e.apply(null,t):e(t)},t)},i.promise}:void 0},r.applied=function(e){return function(t,n){t=t,n=n;var o=arguments;r.safeApply(function(){e.apply(null,o)})}},r}]}),angular.module("auth0.service",["auth0.utils"]).provider("auth",["authUtilsProvider",function(e){function t(e,t){t=t||i.lib;var n=a[t].library();return n[a[t][e]]}function n(e,t){return t=t||i.lib,a[t][e]}function r(t){if(t)return{lib:e.fnName(t),constructor:t};if(null!=window.Auth0Lock)return{lib:"Auth0Lock",constructor:window.Auth0Lock};if(null!=window.Auth0)return{lib:"Auth0",constructor:window.Auth0};if(null!=Auth0Widget)throw new Error("Auth0Widget is not supported with this version of auth0-angularanymore. Please try with an older one");throw new Error("Cannott initialize Auth0Angular. Auth0Lock or Auth0 must be available")}var o={callbackOnLocationHash:!0},i=this,a={Auth0:{signin:"login",signup:"signup",reset:"changePassword",validateUser:"validateUser",library:function(){return i.auth0js},parseOptions:function(e){var t=angular.copy(e);return t.authParams&&(angular.extend(t,t.authParams),delete t.authParams),t}},Auth0Lock:{signin:"show",signup:"showSignup",reset:"showReset",library:function(){return i.auth0lib},parseOptions:function(e){return angular.copy(e)}}};this.init=function(e,t){if(!e)throw new Error("You must set options when calling init");this.loginUrl=e.loginUrl,this.loginState=e.loginState,this.clientID=e.clientID||e.clientId;var n=e.domain;this.sso=e.sso;var i=r(t);this.lib=i.lib,"Auth0Lock"===i.lib?(this.auth0lib=new i.constructor(this.clientID,n,angular.extend(o,e)),this.auth0js=this.auth0lib.getClient(),this.isLock=!0):(this.auth0lib=new i.constructor(angular.extend(o,e)),this.auth0js=this.auth0lib,this.isLock=!1),this.initialized=!0},this.eventHandlers={},this.on=function(e,t){this.eventHandlers[e]||(this.eventHandlers[e]=[]),this.eventHandlers[e].push(t)};var u=["loginSuccess","loginFailure","logout","forbidden","authenticated"];angular.forEach(u,function(t){i["add"+e.capitalize(t)+"Handler"]=function(e){i.on(t,e)}}),this.$get=["$rootScope","$q","$injector","$window","$location","authUtils",function(e,r,o,u,s,l){function c(){i.loginUrl?s.path(i.loginUrl):i.loginState?o.get("$state").go(i.loginState):p("forbidden")}var h={isAuthenticated:!1},f=function(e){return i.eventHandlers[e]},p=function(t,n){e.$broadcast("auth0."+t,n),angular.forEach(f(t)||[],function(e){o.invoke(e,h,n)})},g=function(e,t,n,r,o,i){var a=h.getProfile(e),u={idToken:e,accessToken:t,state:n,refreshToken:r,profile:o,isAuthenticated:!0};return angular.extend(h,u),p(i?"authenticated":"loginSuccess",angular.extend({profilePromise:a},u)),a};e.$on("$locationChangeStart",function(){if(i.initialized){var e=i.auth0lib.parseHash(u.location.hash);if(!h.isAuthenticated){if(e&&e.id_token)return void g(e.id_token,e.access_token,e.state,e.refresh_token);i.sso&&i.auth0js.getSSOData(l.applied(function(e,t){if(t.sso){var n={popup:!1,callbackOnLocationHash:!0,connection:t.lastUsedConnection.name};p("ssoLogin",{loginOptions:n}),h.signin(n,null,null,"Auth0")}}))}}}),e.$on("auth0.forbiddenRequest",function(){c()}),i.loginUrl&&e.$on("$routeChangeStart",function(e,t){i.initialized&&t.$$route&&t.$$route.requiresLogin&&(h.isAuthenticated||h.refreshTokenPromise||s.path(i.loginUrl))}),i.loginState&&e.$on("$stateChangeStart",function(e,t){i.initialized&&t.data&&t.data.requiresLogin&&(h.isAuthenticated||h.refreshTokenPromise||(e.preventDefault(),o.get("$state").go(i.loginState)))}),h.config=i;var d=function(e,t){var n=f("loginSuccess");if(!(t||e.username||e.email||n&&0!==n.length))throw new Error("You must define a loginSuccess handler if not using popup mode or not doing ro call because that means you are doing a redirect")};return h.hookEvents=function(){},h.init=angular.bind(i,i.init),h.getToken=function(e){e=e||{scope:"openid"},e.id_token||e.refresh_token||(e.id_token=h.idToken);var t=l.promisify(i.auth0js.getDelegationToken,i.auth0js);return t(e)},h.refreshIdToken=function(e){var t=l.promisify(i.auth0js.refreshToken,i.auth0js);return h.refreshTokenPromise=t(e||h.refreshToken).then(function(e){return e.id_token})["finally"](function(){h.refreshTokenPromise=null}),h.refreshTokenPromise},h.renewIdToken=function(e){var t=l.promisify(i.auth0js.renewIdToken,i.auth0js);return t(e||h.idToken).then(function(e){return e.id_token})},h.signin=function(e,r,o,u){e=e||{},d(e,r,o),e=n("parseOptions",u)(e);var s=t("signin",u),c=r?function(t,n,o,i,a){n||angular.isUndefined(e.loginAfterSignup)||e.loginAfterSignup?g(n,o,i,a,t).then(function(e){r&&r(e,n,o,i,a)}):r()}:null,h=o?function(e){p("loginFailure",{error:e}),o&&o(e)}:null,f=l.callbackify(s,c,h,a[u||i.lib].library());f(e)},h.signup=function(e,r,o){e=e||{},d(e,r,o),e=n("parseOptions")(e);var a=r?function(t,n,o,i,a){angular.isUndefined(e.auto_login)||e.auto_login?g(n,o,i,a,t).then(function(e){r&&r(e,n,o,i,a)}):r()}:null,u=o?function(e){p("loginFailure",{error:e}),o&&o(e)}:null,s=i.auth0lib,c=l.callbackify(t("signup"),a,u,s);c(e)},h.reset=function(e,r,o){e=e||{},e=n("parseOptions")(e);var a=i.auth0lib,u=l.callbackify(t("reset"),r,o,a);u(e)},h.validateUser=function(e,r,o){e=e||{},e=n("parseOptions")(e);var a=i.auth0lib,u=l.callbackify(t("validateUser"),r,o,a);u(e)},h.signout=function(){h.isAuthenticated=!1,h.profile=null,h.profilePromise=null,h.idToken=null,h.state=null,h.accessToken=null,h.tokenPayload=null,p("logout")},h.authenticate=function(e,t,n,r,o){return g(t,n,r,o,e,!0)},h.getProfile=function(e){var t=l.promisify(i.auth0lib.getProfile,i.auth0lib);return h.profilePromise=t(e||h.idToken),h.profilePromise.then(function(e){return h.profile=e,e})},h}]}])}();(function(){"use strict";angular.module("app.common",[])})();(function(){"use strict";angular.module("app.common").directive("ptNavbar",e);function e(){return{templateUrl:"/common/directives/navbar.html",restrict:"E",controller:t,controllerAs:"vm"}}t.$inject=["auth","store","$location"];function t(e,t,n){var r=this;r.auth=e;r.login=function(){e.signin({},function(e,r){t.set("profile",e);t.set("token",r);n.path("/createpin")},function(e){console.log(e)})};r.logout=function(){e.signout();t.remove("profile");t.remove("token");n.path("/")}}})();(function(){"use strict";angular.module("app.common").factory("pinModel",e);e.$inject=[];function e(){function e(){this.title="";this.image="";this.description="";this.author="",this.uid=""}return{model:e}}})();(function(){"use strict";angular.module("app.common").factory("pinsService",e);e.$inject=["$http"];function e(e){function t(t){return e.get("/api/uploadImage",{params:{url:t}})}function n(){return e.get("/api/pins")}function r(t){return e.get("/api/pins/user/"+t)}function o(t){return e.post("/api/pins",t)}function i(t){return e.delete("/api/pins/"+t)}return{uploadImage:t,getPins:n,getPinsByUserId:r,createPin:o,deletePin:i}}})();(function(){"use strict";angular.module("app.home",[])})();(function(){"use strict";angular.module("app.home").config(e);e.$inject=["$routeProvider"];function e(e){e.when("/",{templateUrl:"/home/home.html",controller:"homeController",controllerAs:"vm"})}})();(function(){"use strict";angular.module("app.pinboard",[])})();(function(){"use strict";angular.module("app.pinboard").config(e);e.$inject=["$routeProvider"];function e(e){e.when("/pinboard",{templateUrl:"/pinboard/pinboard.html",controller:"pinboardController",controllerAs:"vm",requiresLogin:true});e.when("/createpin",{templateUrl:"/pinboard/createpin.html",controller:"createpinController",controllerAs:"vm",requiresLogin:true});e.when("/user/:username/id/:userid",{templateUrl:"/pinboard/user.html",controller:"userController",controllerAs:"vm"})}})();(function(){"use strict";angular.module("app.pinboard").controller("pinboardController",e);e.$inject=["pinsService"];function e(e){var t=this;t.pins;t.profile=JSON.parse(localStorage.getItem("profile"));t.delete=function(t){e.deletePin(t).then(function(e){n()}).catch(function(e){console.log(e)})};function n(){e.getPinsByUserId(t.profile.user_id).then(function(e){console.log(e);t.pins=e.data}).catch(function(e){console.log(e)})}n()}})();(function(){"use strict";angular.module("app.pinboard").controller("createpinController",e);e.$inject=["pinsService","pinModel","$timeout"];function e(e,t,n){var r=this;r.newPin=new t.model;r.profile=JSON.parse(localStorage.getItem("profile"));r.isCreated=null;r.error=null;r.createpin=function(){e.uploadImage(r.newPin.image).then(function(t){r.newPin.image=t.data.img;if(r.profile.screen_name){r.newPin.author=r.profile.screen_name}else{r.newPin.author=r.profile.nickname}r.newPin.uid=r.profile.user_id;return e.createPin(r.newPin)}).then(function(e){console.log(e);r.newPin=new t.model;r.isCreated=true;n(function(){r.isCreated=null},1500)}).catch(function(e){console.log(e);r.error=e.statusText;r.newPin=new t.model;r.isCreated=false;n(function(){r.isCreated=null;r.error=null},2e3)})}}})();(function(){"use strict";angular.module("app.pinboard").controller("userController",e);e.$inject=["$routeParams","pinsService"];function e(e,t){var n=this;n.username=e.username;n.pins;t.getPinsByUserId(e.userid).then(function(e){n.pins=e.data}).catch(function(e){console.log(e)})}})();